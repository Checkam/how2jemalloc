# Variables
EXE=adjacent-memory use-after-free heap-manipulation

# Usual compilation flags
CFLAGS=-std=c11 -L lib/ -g -Wl,-rpath=lib/
CPPFLAGS=-I./include 
LDFLAGS=-ljemalloc

# Special rules and targets
.PHONY: all clean help

# Rules and targets
all: $(EXE)

# adjacent-memory binary
adjacent-memory: adjacent-memory.o
	$(CC) $(CFLAGS) -o $@ $^ $(LDFLAGS)

adjacent-memory.o : adjacent-memory.c 
	$(CC) $(CFLAGS) $(CPPFLAGS) -c $<

# use-after-free binary
use-after-free: use-after-free.o
	$(CC) $(CFLAGS) -o $@ $^ $(LDFLAGS)

use-after-free.o : use-after-free.c 
	$(CC) $(CFLAGS) $(CPPFLAGS) -c $<

# heap-manipulation binary
heap-manipulation: heap-manipulation.o
	$(CC) $(CFLAGS) -o $@ $^ $(LDFLAGS)

heap-manipulation.o: heap-manipulation.c
	$(CC) $(CFLAGS) $(CPPFLAGS) -c $<


clean:
	@rm -f *~ *.o $(EXE)

help:
	@echo "Usage:"
	@echo "  make [all]\t\tBuild the software"
	@echo "  make clean\t\tRemove all files generated by make"
	@echo "  make help\t\tDisplay this help"
